# API Token é…ç½®è¯´æ˜Ž

## ðŸ” å…³äºŽ "COZE_API_TOKEN" çš„é”™è¯¯æç¤º

### é‡è¦è¯´æ˜Ž

**ä½ çœ‹åˆ°è¿™ä¸ªé”™è¯¯æç¤ºå¾ˆå¯èƒ½æ˜¯å› ä¸º**ï¼š
- ä½ åœ¨æŸ¥çœ‹Cozeå¹³å°çš„å…¶ä»–ç¤ºä¾‹æˆ–æ–‡æ¡£
- æˆ–è€…ä½ åœ¨ä½¿ç”¨å…¶ä»–çš„å‰ç«¯æ¨¡æ¿

**ä½†åœ¨å½“å‰é¡¹ç›®ä¸­ï¼Œä½ ä¸éœ€è¦é…ç½® COZE_API_TOKENï¼**

## âœ… å½“å‰é¡¹ç›®çš„æž¶æž„

### å·¥ä½œåŽŸç†

```
æµè§ˆå™¨ â†’ å‰ç«¯é¡µé¢ (index.html)
    â†“
    â†“ è°ƒç”¨: http://localhost:8000/api/stream
    â†“
æœ¬åœ°HTTPæœåŠ¡å™¨ (main.py)
    â†“
    â†“ è°ƒç”¨ Agent (agents/agent.py)
    â†“
Agent (LangChain)
    â†“
    â†“ ä½¿ç”¨: COZE_WORKLOAD_IDENTITY_API_KEY (è‡ªåŠ¨é…ç½®)
    â†“
Cozeå¹³å°API â†’ deepseek-r1-250528æ¨¡åž‹
```

### å…³é”®ç‚¹

1. **å‰ç«¯ä¸ç›´æŽ¥è°ƒç”¨Coze API**
   - å‰ç«¯è°ƒç”¨çš„æ˜¯æœ¬åœ°çš„ `/api/stream` ç«¯ç‚¹
   - æœ¬åœ°æœåŠ¡å™¨å¤„ç†APIè°ƒç”¨

2. **Tokenç”±Cozeå¹³å°è‡ªåŠ¨é…ç½®**
   - `COZE_WORKLOAD_IDENTITY_API_KEY` åœ¨Cozeæ²™ç®±çŽ¯å¢ƒä¸­å·²è‡ªåŠ¨é…ç½®
   - ä½ ä¸éœ€è¦æ‰‹åŠ¨é…ç½®ä»»ä½•Token

3. **ä¸éœ€è¦ .env.local æ–‡ä»¶**
   - é¡¹ç›®ä¸ä½¿ç”¨çŽ¯å¢ƒå˜é‡æ–‡ä»¶æ¥é…ç½®Token
   - æ‰€æœ‰å¿…éœ€çš„çŽ¯å¢ƒå˜é‡éƒ½å·²é€šè¿‡Cozeå¹³å°è‡ªåŠ¨æ³¨å…¥

## ðŸš€ æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼

### åœ¨Cozeå¹³å°ä¸Šä½¿ç”¨ï¼ˆæŽ¨èï¼‰

ç›´æŽ¥è®¿é—®ï¼š
```
http://wdssb8q7gh.coze.site/
```

æ— éœ€ä»»ä½•é…ç½®ï¼Œç›´æŽ¥å¼€å§‹å¯¹è¯å³å¯ã€‚

### æœ¬åœ°æµ‹è¯•ï¼ˆå¦‚æžœåœ¨æœ¬åœ°è¿è¡Œï¼‰

```bash
# 1. ç¡®ä¿åœ¨Cozeæ²™ç®±çŽ¯å¢ƒ
echo $COZE_WORKLOAD_IDENTITY_API_KEY

# 2. å¯åŠ¨HTTPæœåŠ¡
bash scripts/http_run.sh -p 8000

# 3. è®¿é—®æœ¬åœ°é¡µé¢
http://localhost:8000
```

## ðŸ¤” ä»€ä¹ˆæ—¶å€™éœ€è¦é…ç½® COZE_API_TOKENï¼Ÿ

åªæœ‰åœ¨ä½ åˆ›å»ºä¸€ä¸ª**ç›´æŽ¥è°ƒç”¨Coze APIçš„å‰ç«¯åº”ç”¨**æ—¶ï¼Œæ‰éœ€è¦é…ç½®è¿™ä¸ªTokenã€‚

### ç¤ºä¾‹åœºæ™¯

å¦‚æžœä½ çš„å‰ç«¯ä»£ç æ˜¯è¿™æ ·çš„ï¼š

```javascript
// âŒ ç›´æŽ¥è°ƒç”¨Coze APIï¼ˆéœ€è¦Tokenï¼‰
fetch('https://api.coze.cn/v3/chat', {
    headers: {
        'Authorization': 'Bearer COZE_API_TOKEN',  // éœ€è¦é…ç½®
        'Content-Type': 'application/json'
    }
});
```

é‚£ä¹ˆä½ ç¡®å®žéœ€è¦é…ç½® `COZE_API_TOKEN`ã€‚

ä½†æˆ‘ä»¬çš„å®žçŽ°æ˜¯ï¼š

```javascript
// âœ… è°ƒç”¨æœ¬åœ°ç«¯ç‚¹ï¼ˆä¸éœ€è¦Tokenï¼‰
fetch('/api/stream', {
    headers: {
        'Content-Type': 'application/json'
    }
});
```

## ðŸ”§ å¦‚æžœç¡®å®žéœ€è¦é…ç½® COZE_API_TOKEN

å¦‚æžœä½ ç¡®å®žè¦åˆ›å»ºä¸€ä¸ªç›´æŽ¥è°ƒç”¨Coze APIçš„åº”ç”¨ï¼š

### æ­¥éª¤1ï¼šä»ŽCozeå¹³å°èŽ·å–Token

1. ç™»å½• https://www.coze.cn/
2. è¿›å…¥ä½ çš„Agentè®¾ç½®é¡µé¢
3. æ‰¾åˆ°"API Token"æˆ–"å¯†é’¥ç®¡ç†"
4. å¤åˆ¶Token

### æ­¥éª¤2ï¼šåˆ›å»ºçŽ¯å¢ƒå˜é‡æ–‡ä»¶

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º .env.local æ–‡ä»¶
cat > .env.local << EOF
COZE_API_TOKEN=ä½ çš„tokenå€¼
EOF
```

### æ­¥éª¤3ï¼šåœ¨ä»£ç ä¸­ä½¿ç”¨

```python
import os
from dotenv import load_dotenv

# åŠ è½½çŽ¯å¢ƒå˜é‡
load_dotenv('.env.local')

# èŽ·å–Token
api_token = os.getenv('COZE_API_TOKEN')

# ä½¿ç”¨Tokenè°ƒç”¨API
headers = {
    'Authorization': f'Bearer {api_token}',
    'Content-Type': 'application/json'
}
```

### æ­¥éª¤4ï¼šé‡å¯æœåŠ¡

```bash
bash scripts/http_run.sh -p 8000
```

## ðŸ“Š ä¸¤ç§æž¶æž„å¯¹æ¯”

| æ–¹é¢ | æœ¬åœ°æœåŠ¡æž¶æž„ï¼ˆå½“å‰é¡¹ç›®ï¼‰ | ç›´æŽ¥è°ƒç”¨Coze API |
|------|------------------------|-----------------|
| Tokené…ç½® | è‡ªåŠ¨é…ç½® | éœ€è¦æ‰‹åŠ¨é…ç½® |
| å®‰å…¨æ€§ | æ›´é«˜ï¼ˆTokenåœ¨æœåŠ¡å™¨ç«¯ï¼‰ | è¾ƒä½Žï¼ˆTokenåœ¨å‰ç«¯ï¼‰ |
| å®žçŽ°å¤æ‚åº¦ | ç®€å• | å¤æ‚ |
| é€‚ç”¨åœºæ™¯ | Cozeæ²™ç®±çŽ¯å¢ƒ | ç‹¬ç«‹éƒ¨ç½² |
| çŽ¯å¢ƒå˜é‡ | COZE_WORKLOAD_IDENTITY_API_KEY | COZE_API_TOKEN |

## âœ… éªŒè¯å½“å‰é…ç½®

### æ£€æŸ¥çŽ¯å¢ƒå˜é‡æ˜¯å¦å·²è‡ªåŠ¨é…ç½®

```bash
# æ£€æŸ¥å…³é”®çš„Tokenå˜é‡
echo $COZE_WORKLOAD_IDENTITY_API_KEY
echo $COZE_INTEGRATION_MODEL_BASE_URL

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š
# YWF3eWk1RlN4UWNQQVJPdVBmeUhINWZhSFpCcGhoczA6...
# https://integration.coze.cn/api/v3
```

### æµ‹è¯•æœåŠ¡

```bash
# å¯åŠ¨æœåŠ¡
bash scripts/http_run.sh -p 8000

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æµ‹è¯•
curl http://localhost:8000/
# åº”è¯¥è¿”å›žHTMLé¡µé¢å†…å®¹
```

## ðŸ’¡ å»ºè®®

1. **åœ¨Cozeå¹³å°ä¸Š**ï¼šç›´æŽ¥ä½¿ç”¨ï¼Œæ— éœ€é…ç½®ä»»ä½•Token
2. **æœ¬åœ°æµ‹è¯•**ï¼šç¡®ä¿åœ¨Cozeæ²™ç®±çŽ¯å¢ƒä¸­ï¼Œæ‰€æœ‰Tokenå·²è‡ªåŠ¨é…ç½®
3. **å¦‚æžœç¡®å®žéœ€è¦ç‹¬ç«‹éƒ¨ç½²**ï¼šå‚è€ƒä¸Šæ–¹æ­¥éª¤é…ç½® `COZE_API_TOKEN`

## ðŸ› æ•…éšœæŽ’æŸ¥

### é—®é¢˜ï¼šå¯åŠ¨æœåŠ¡æ—¶æŠ¥é”™ç¼ºå°‘çŽ¯å¢ƒå˜é‡

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# é‡æ–°åŠ è½½çŽ¯å¢ƒå˜é‡
source scripts/load_env.sh

# ç„¶åŽå¯åŠ¨æœåŠ¡
bash scripts/http_run.sh -p 8000
```

### é—®é¢˜ï¼šå‰ç«¯è°ƒç”¨APIå¤±è´¥

**æ£€æŸ¥ç‚¹**ï¼š
1. ç¡®è®¤æœåŠ¡æ­£åœ¨è¿è¡Œï¼š`ps aux | grep python`
2. ç¡®è®¤ç«¯å£æ­£ç¡®ï¼š`netstat -tlnp | grep 8000`
3. æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼š`tail -f /app/work/logs/bypass/app.log`
4. æ£€æŸ¥æµè§ˆå™¨æŽ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

---

**æœ€åŽæ›´æ–°**ï¼š2025-01-02
**ç‰ˆæœ¬**ï¼š1.0.0
