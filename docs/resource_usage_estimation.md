# 职场情绪充电站 - 资源点消耗预估

## 概述

本文档详细说明了职场情绪充电站Agent在各种场景下的资源点消耗预估，帮助您了解和控制资源使用成本。

## 资源点消耗标准

| 调用类型 | 资源点消耗 | 说明 |
|---------|-----------|------|
| 数据库操作（查询/写入） | 0点 | PostgreSQL数据库操作 |
| LLM推理（纯文本） | 0点 | 使用deepseek-r1-250528模型
| 天气API调用 | 1-2点 | 外部天气API |
| 八字分析API调用 | 5-10点 | 外部八字API或联网搜索 |
| 紫微斗数API调用 | 5-10点 | 外部紫微斗数API或联网搜索 |
| 图表生成（QuickChart） | 0点 | 免费API |
| **已禁用：生成穿搭图片** | 50-100点 | 豆包生图模型（已禁用） |
| **已禁用：上传用户照片** | 10-20点 | 对象存储+处理（已禁用） |
| **已禁用：小红书爬取** | 20-30点 | 小红书API（已禁用） |
| **已禁用：MBTI联网搜索** | 5-10点 | 联网搜索（已禁用，使用内置知识） |

## 场景分析

### 1. 首次来访（生成完整报告）

用户第一次访问，需要填写个人信息并生成完整报告。

**调用流程：**
1. 检查用户状态（check_user_info_exists）: 0点
2. 保存用户信息（add_roster_entry）: 0点
3. 八字分析（bazi_api_analysis）: 5-10点（一次获取人生解读+每日运势）
4. 职场建议（career_advice）: 0点（使用内置知识，不调用工具）
5. 天气查询（get_weather）: 1-2点
6. 穿搭建议: 0点（基于天气和命理信息，使用Prompt生成）

**总消耗：约6-12点/次**

**适用场景：**
- 新用户注册
- 清除缓存后重新访问

---

### 2. 再次来访（查看报告）

用户第二次访问，已有个人信息，查看已生成的报告。

**调用流程：**
1. 检查用户状态（check_user_info_exists）: 0点
2. 读取人生解读（get_life_interpretation）: 0点（从数据库读取）
3. 读取每日运势: 0点（重新计算，使用保存的八字数据）
4. 读取职场建议（get_career_trend）: 0点（从数据库读取）
5. 天气查询（get_weather）: 1-2点
6. 穿搭建议: 0点（基于天气和命理信息，使用Prompt生成）

**总消耗：约1-2点/次**

**适用场景：**
- 已注册用户每天访问
- 查看历史报告

---

### 3. 简单问答（不调用工具）

用户提出简单的职场问题或情绪咨询，不需要调用任何工具。

**调用流程：**
- 纯文本对话（LLM推理）: 0点

**总消耗：约0点/次**

**适用场景：**
- 职场咨询
- 情绪支持
- 一般问答
- 职场信息补充

---

### 4. 生成运势趋势图

用户要求生成运势趋势图。

**调用流程：**
1. 读取八字数据: 0点（从数据库读取）
2. 生成图表（generate_luck_chart）: 0点（QuickChart免费API）

**总消耗：约0点/次**

**适用场景：**
- 查看运势趋势
- 生成可视化报告

---

### 5. 紫微斗数深度分析

用户要求进行紫微斗数深度分析。

**调用流程：**
1. 读取八字数据: 0点（从数据库读取）
2. 紫微斗数分析（ziwei_analysis）: 5-10点

**总消耗：约5-10点/次**

**适用场景：**
- 用户主动要求紫微斗数分析
- 深度命理分析需求

---

### 6. 人际关系建议

用户询问人际关系问题。

**调用流程：**
1. 读取花名册信息（get_roster_entries）: 0点（从数据库读取）
2. 人际关系建议（relationship_advice）: 0点（使用LLM推理，不调用外部API）

**总消耗：约0点/次**

**适用场景：**
- 职场人际关系咨询
- 冲突解决建议
- 团队协作建议

---

### 7. 职业转型建议

用户有职业转型需求。

**调用流程：**
1. 读取用户职场信息（get_roster_entries）: 0点（从数据库读取）
2. 职业转型建议（career_transition_advice）: 0点（使用LLM推理，不调用外部API）

**总消耗：约0点/次**

**适用场景：**
- 职业规划咨询
- 转型建议
- 技能差距分析

---

## 资源消耗优化对比

### 优化前（包含高消耗功能）

| 场景 | 资源点消耗 | 说明 |
|-----|----------|------|
| 首次来访 | 56-132点 | 包含生成穿搭图片（50-100点） |
| 再次来访 | 51-102点 | 包含生成穿搭图片（50-100点） |
| 简单问答 | 0-30点 | 可能包含小红书爬取（20-30点） |

**问题：**
- 一上午调试可能消耗500点资源
- 每次访问都消耗大量资源
- 高消耗功能（生成图片）非核心需求

### 优化后（禁用高消耗功能）

| 场景 | 资源点消耗 | 说明 |
|-----|----------|------|
| 首次来访 | 6-12点 | 不生成穿搭图片，使用内置知识 |
| 再次来访 | 1-2点 | 不生成穿搭图片，使用内置知识 |
| 简单问答 | 0点 | 纯文本对话，不调用外部API |

**优势：**
- 资源消耗降低约90%
- 每天访问1次，仅消耗1-2点
- 500点资源可使用约40-80天（每天访问）

---

## 已禁用的高消耗功能

### 1. 生成穿搭图片（generate_outfit_image）
- **消耗**: 50-100点/次
- **原因**: 非核心功能，替代方案是提供文字描述的穿搭建议
- **替代方案**: 基于天气和命理幸运色生成文字穿搭建议

### 2. 上传用户照片（upload_user_photo）
- **消耗**: 10-20点/次
- **原因**: 非核心功能，照片上传+处理消耗较大
- **替代方案**: 仅基于文字信息生成建议

### 3. 小红书流行趋势爬取（get_fashion_trends）
- **消耗**: 20-30点/次
- **原因**: 非核心功能，流行趋势变化快，实时性要求不高
- **替代方案**: 使用Prompt内置的穿搭知识

### 4. MBTI联网搜索（mbti_analysis）
- **消耗**: 5-10点/次
- **原因**: MBTI知识相对稳定，无需实时联网
- **替代方案**: 使用Prompt内置的MBTI知识库

---

## 资源使用建议

### 1. 调试阶段
- 使用模拟数据测试，不要每次都调用真实API
- 优先测试简单问答场景（0点消耗）
- 避免重复测试首次来访（6-12点消耗）

### 2. 正式使用
- 充分利用数据库缓存，减少重复调用
- 鼓励用户一次性提供完整信息，避免多次调用
- 推荐用户每天访问1-2次即可

### 3. 监控与预警
- 监控每日资源消耗
- 设置预警阈值（如每日50点）
- 定期分析资源使用情况

---

## 成本估算

### 基于500点资源点的预估

| 使用频率 | 每次消耗 | 每天消耗 | 可使用天数 |
|---------|---------|---------|-----------|
| 每天访问1次（简单问答） | 0点 | 0点 | ∞ |
| 每天访问1次（查看报告） | 1-2点 | 1-2点 | 250-500天 |
| 每天访问2次（查看报告） | 1-2点 | 2-4点 | 125-250天 |
| 每天访问1次（新用户） | 6-12点 | 6-12点 | 42-83天 |

### 优化前 vs 优化后对比

| 指标 | 优化前 | 优化后 | 改善 |
|-----|-------|-------|------|
| 首次来访消耗 | 56-132点 | 6-12点 | 降低约90% |
| 再次来访消耗 | 51-102点 | 1-2点 | 降低约98% |
| 每天访问1次（查看报告） | 51-102点 | 1-2点 | 降低约98% |
| 500点可使用天数 | 5-10天 | 250-500天 | 提升25-50倍 |

---

## 总结

通过禁用高消耗功能并优化工具调用策略，职场情绪充电站Agent的资源点消耗降低了约90%：

1. **首次来访**: 从56-132点降至6-12点
2. **再次来访**: 从51-102点降至1-2点
3. **500点资源**: 从5-10天可提升至250-500天

**关键优化措施：**
- ✅ 禁用生成穿搭图片（50-100点）
- ✅ 禁用上传用户照片（10-20点）
- ✅ 禁用小红书爬取（20-30点）
- ✅ 禁用MBTI联网搜索，使用内置知识（5-10点）
- ✅ 穿搭建议使用Prompt生成，不调用外部工具
- ✅ 充分利用数据库缓存，减少重复调用

**建议：**
- 调试时使用模拟数据，减少真实API调用
- 监控资源使用情况，设置预警阈值
- 鼓励用户合理使用，避免频繁访问
