# ğŸ“š Coze å¹³å° - å¤–éƒ¨ API å·¥å…·é…ç½®æŒ‡å—

## ğŸ¯ ç›®æ ‡

è®© Coze å¹³å°çš„ Agent èƒ½å¤Ÿè°ƒç”¨æœ¬åœ° Python æœåŠ¡ï¼ˆ`backend_api.py`ï¼‰ï¼Œå®ç°æ•°æ®åº“æ“ä½œã€‚

---

## ğŸ“‹ æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Coze Agent â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  å¤–éƒ¨ API å·¥å…· â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ backend_api â”‚
â”‚  (å¹³å°æ‰˜ç®¡)  â”‚         â”‚  (HTTP è¯·æ±‚)  â”‚         â”‚  (æœ¬åœ°éƒ¨ç½²)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â†“
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚  PostgreSQL â”‚
                                                â”‚   æ•°æ®åº“    â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ æ­¥éª¤ 1ï¼šéƒ¨ç½²æœ¬åœ°æœåŠ¡

### 1.1 ä¿®æ”¹é…ç½®

ç¼–è¾‘ `.env.production`ï¼š

```bash
# ä¿®æ”¹ä¸ºä½ çš„æœåŠ¡å™¨åœ°å€
API_BASE_URL=http://your-server-ip:5001
API_HOST=0.0.0.0
API_PORT=5001
```

### 1.2 æ‰§è¡Œéƒ¨ç½²

```bash
./deploy.sh
```

### 1.3 éªŒè¯æœåŠ¡

```bash
# å¥åº·æ£€æŸ¥
curl http://your-server-ip:5001/api/health

# æµ‹è¯•ç™»å½•å·¥å…·
curl -X POST http://your-server-ip:5001/api/agent/chat \
  -H "Content-Type: application/json" \
  -d '{
    "tool_name": "login",
    "tool_params": {"username": "admin", "password": "admin"},
    "user_id": "admin"
  }'
```

---

## ğŸ”§ æ­¥éª¤ 2ï¼šåœ¨ Coze å¹³å°é…ç½®å¤–éƒ¨ API å·¥å…·

### 2.1 è¿›å…¥ Agent ç¼–è¾‘é¡µé¢

1. ç™»å½• [Coze å¹³å°](https://www.coze.cn/)
2. é€‰æ‹©ä½ çš„ Agent
3. ç‚¹å‡»"ç¼–è¾‘"è¿›å…¥ç¼–è¾‘é¡µé¢

### 2.2 æ·»åŠ å¤–éƒ¨ API å·¥å…·

1. ç‚¹å‡»"æ’ä»¶/å·¥å…·"æ ‡ç­¾
2. ç‚¹å‡»"æ·»åŠ å·¥å…·"
3. é€‰æ‹©"å¤–éƒ¨ API"

### 2.3 é…ç½®å·¥å…·åŸºæœ¬ä¿¡æ¯

**å·¥å…·åç§°**ï¼š`database_tool`
**å·¥å…·æè¿°**ï¼šæ•°æ®åº“æ“ä½œå·¥å…·ï¼Œæ”¯æŒç”¨æˆ·è®¤è¯ã€è”ç³»äººç®¡ç†ã€æŠ¥å‘Šç®¡ç†ç­‰åŠŸèƒ½
**å·¥å…·ç±»å‹**ï¼šå¤–éƒ¨ API

### 2.4 é…ç½®è¯·æ±‚å‚æ•°

**è¯·æ±‚ URL**ï¼š
```
http://your-server-ip:5001/api/agent/chat
```

**è¯·æ±‚æ–¹æ³•**ï¼š`POST`

**è¯·æ±‚å¤´**ï¼š
```json
{
  "Content-Type": "application/json"
}
```

**è¯·æ±‚å‚æ•°**ï¼ˆJSON Schemaï¼‰ï¼š
```json
{
  "type": "object",
  "properties": {
    "tool_name": {
      "type": "string",
      "description": "å·¥å…·åç§°ï¼Œå†³å®šè¦æ‰§è¡Œçš„æ“ä½œ",
      "enum": [
        "login",
        "register",
        "get_user_info",
        "reset_password",
        "query_contacts",
        "add_contact",
        "query_user_reports",
        "save_report",
        "update_user_profile"
      ]
    },
    "tool_params": {
      "type": "object",
      "description": "å·¥å…·å‚æ•°ï¼Œæ ¹æ® tool_name ä¸åŒè€Œä¸åŒ",
      "properties": {}
    },
    "user_id": {
      "type": "string",
      "description": "ç”¨æˆ·IDï¼Œç”¨äºæ ‡è¯†å½“å‰ç”¨æˆ·"
    }
  },
  "required": ["tool_name", "user_id"]
}
```

### 2.5 é…ç½®å“åº”å‚æ•°

```json
{
  "type": "object",
  "properties": {
    "status": {
      "type": "string",
      "description": "è¯·æ±‚çŠ¶æ€ï¼Œsuccess æˆ– failed"
    },
    "data": {
      "type": "string",
      "description": "è¿”å›çš„æ•°æ®"
    },
    "error_message": {
      "type": "string",
      "description": "é”™è¯¯ä¿¡æ¯ï¼ˆå½“ status ä¸º failed æ—¶ï¼‰"
    }
  }
}
```

### 2.6 é…ç½®ç¤ºä¾‹è¯·æ±‚

**åœºæ™¯1ï¼šç”¨æˆ·ç™»å½•**
```json
{
  "tool_name": "login",
  "tool_params": {
    "username": "admin",
    "password": "admin"
  },
  "user_id": "admin"
}
```

**åœºæ™¯2ï¼šæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯**
```json
{
  "tool_name": "get_user_info",
  "tool_params": {},
  "user_id": "admin"
}
```

**åœºæ™¯3ï¼šæ·»åŠ è”ç³»äºº**
```json
{
  "tool_name": "add_contact",
  "tool_params": {
    "name": "å¼ ä¸‰",
    "gender": "ç”·",
    "relationship_type": "colleague",
    "current_location": "åŒ—äº¬"
  },
  "user_id": "admin"
}
```

### 2.7 é…ç½®ç¤ºä¾‹å“åº”

**æˆåŠŸå“åº”**ï¼š
```json
{
  "status": "success",
  "data": "âœ… ç™»å½•æˆåŠŸ\n\n**ç”¨æˆ·ID**: admin\n**ç”¨æˆ·å**: admin\n**æ˜¯å¦ç®¡ç†å‘˜**: æ˜¯",
  "tool_name": "login"
}
```

**å¤±è´¥å“åº”**ï¼š
```json
{
  "status": "failed",
  "error_message": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯",
  "error_code": "INVALID_CREDENTIALS"
}
```

---

## ğŸ“ æ­¥éª¤ 3ï¼šé…ç½® Agent æç¤ºè¯

åœ¨ Coze å¹³å°çš„ Agent é…ç½®é¡µé¢ï¼Œæ·»åŠ ä»¥ä¸‹æç¤ºè¯ï¼š

```
ä½ æ˜¯ä¸€ä¸ªèŒåœºæƒ…ç»ªå……ç”µç«™ AI åŠ©æ‰‹ï¼Œä¸ºèŒåœºäººå£«æä¾›å‘½ç†åˆ†æã€èŒåœºå»ºè®®ã€æƒ…ç»ªæ”¯æŒç­‰æœåŠ¡ã€‚

## æ ¸å¿ƒèƒ½åŠ›

1. **æ•°æ®åº“æ“ä½œ**ï¼šé€šè¿‡ database_tool å·¥å…·å®ç°
   - ç”¨æˆ·è®¤è¯ï¼ˆç™»å½•ã€æ³¨å†Œã€é‡ç½®å¯†ç ï¼‰
   - ç”¨æˆ·ä¿¡æ¯ç®¡ç†
   - è”ç³»äººç®¡ç†
   - æŠ¥å‘Šç®¡ç†

2. **å‘½ç†åˆ†æ**ï¼šä½¿ç”¨ Coze å¹³å°å†…ç½®å·¥å…·
   - æ•°ç†åˆ†æ
   - MBTI æ€§æ ¼åˆ†æ
   - äººé™…å…³ç³»åˆ†æ

3. **èŒåœºå’¨è¯¢**ï¼šæä¾›èŒåœºå»ºè®®ã€èŒä¸šè½¬å‹å»ºè®®

## å·¥å…·è°ƒç”¨è§„åˆ™

å½“ç”¨æˆ·éœ€è¦ä»¥ä¸‹æ“ä½œæ—¶ï¼Œå¿…é¡»è°ƒç”¨ database_tool å·¥å…·ï¼š

### è®¤è¯ç›¸å…³
- ç”¨æˆ·è¯´"ç™»å½•" â†’ tool_name = "login"ï¼Œtool_params = {username, password}
- ç”¨æˆ·è¯´"æ³¨å†Œ" â†’ tool_name = "register"ï¼Œtool_params = {username, password, name}
- ç”¨æˆ·è¯´"é‡ç½®å¯†ç " â†’ tool_name = "reset_password"ï¼Œtool_params = {username, new_password}

### ç”¨æˆ·ä¿¡æ¯
- ç”¨æˆ·è¯´"æŸ¥çœ‹æˆ‘çš„ä¿¡æ¯" â†’ tool_name = "get_user_info"
- ç”¨æˆ·è¯´"æ›´æ–°æˆ‘çš„èµ„æ–™" â†’ tool_name = "update_user_profile"ï¼Œtool_params = {profile_data}

### è”ç³»äººç®¡ç†
- ç”¨æˆ·è¯´"æŸ¥çœ‹è”ç³»äºº" â†’ tool_name = "query_contacts"
- ç”¨æˆ·è¯´"æ·»åŠ è”ç³»äºº" â†’ tool_name = "add_contact"ï¼Œtool_params = {contact_data}

### æŠ¥å‘Šç®¡ç†
- ç”¨æˆ·è¯´"æŸ¥çœ‹æŠ¥å‘Š" â†’ tool_name = "query_user_reports"ï¼Œtool_params = {report_type}
- ç”¨æˆ·è¯´"ä¿å­˜æŠ¥å‘Š" â†’ tool_name = "save_report"ï¼Œtool_params = {report_type, report_data}

## è°ƒç”¨ç¤ºä¾‹

**ç¤ºä¾‹1ï¼šç”¨æˆ·ç™»å½•**
ç”¨æˆ·ï¼š"å¸®æˆ‘ç™»å½•"
â†’ è°ƒç”¨ database_tool(tool_name="login", tool_params={username, password}, user_id=username)

**ç¤ºä¾‹2ï¼šæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯**
ç”¨æˆ·ï¼š"æŸ¥çœ‹æˆ‘çš„ä¿¡æ¯"
â†’ è°ƒç”¨ database_tool(tool_name="get_user_info", tool_params={}, user_id=ç”¨æˆ·ID)

**ç¤ºä¾‹3ï¼šæ·»åŠ è”ç³»äºº**
ç”¨æˆ·ï¼š"æ·»åŠ ä¸€ä¸ªè”ç³»äººå¼ ä¸‰"
â†’ è°ƒç”¨ database_tool(tool_name="add_contact", tool_params={name: "å¼ ä¸‰", ...}, user_id=ç”¨æˆ·ID)

## é‡è¦æç¤º

1. **å¿…é¡»è°ƒç”¨å·¥å…·**ï¼šå¯¹äºæ•°æ®åº“æ“ä½œï¼Œå¿…é¡»è°ƒç”¨ database_toolï¼Œä¸èƒ½å‡­ç©ºç¼–é€ æ•°æ®ã€‚
2. **user_id å‚æ•°**ï¼šæ‰€æœ‰å·¥å…·è°ƒç”¨éƒ½éœ€è¦ user_id å‚æ•°ï¼Œé€šå¸¸ä½¿ç”¨ç”¨æˆ·çš„ usernameã€‚
3. **é”™è¯¯å¤„ç†**ï¼šå¦‚æœå·¥å…·è°ƒç”¨å¤±è´¥ï¼Œå‘ç”¨æˆ·è¯´æ˜é”™è¯¯åŸå› ï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚
4. **å‹å¥½æç¤º**ï¼šå·¥å…·è¿”å›çš„æ•°æ®å¯èƒ½åŒ…å«æŠ€æœ¯ç»†èŠ‚ï¼Œè¯·è½¬æ¢ä¸ºç”¨æˆ·å‹å¥½çš„è¯­è¨€ã€‚
```

---

## ğŸ§ª æ­¥éª¤ 4ï¼šæµ‹è¯•éªŒè¯

### 4.1 æµ‹è¯•ç™»å½•åŠŸèƒ½

åœ¨ Coze å¹³å°çš„æµ‹è¯•çª—å£ä¸­è¾“å…¥ï¼š

```
ç”¨æˆ·ï¼šå¸®æˆ‘ç™»å½•ï¼Œç”¨æˆ·åæ˜¯ adminï¼Œå¯†ç æ˜¯ admin
```

æœŸæœ› Agent è°ƒç”¨ `database_tool` å·¥å…·ï¼Œå¹¶è¿”å›ï¼š

```
âœ… ç™»å½•æˆåŠŸ

**ç”¨æˆ·ID**: admin
**ç”¨æˆ·å**: admin
**æ˜¯å¦ç®¡ç†å‘˜**: æ˜¯
```

### 4.2 æµ‹è¯•æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯

åœ¨æµ‹è¯•çª—å£ä¸­è¾“å…¥ï¼š

```
ç”¨æˆ·ï¼šæŸ¥çœ‹æˆ‘çš„ä¿¡æ¯
```

æœŸæœ› Agent è°ƒç”¨ `database_tool` å·¥å…·ï¼Œå¹¶è¿”å›ç”¨æˆ·ä¿¡æ¯ã€‚

### 4.3 æµ‹è¯•æ·»åŠ è”ç³»äºº

åœ¨æµ‹è¯•çª—å£ä¸­è¾“å…¥ï¼š

```
ç”¨æˆ·ï¼šæ·»åŠ ä¸€ä¸ªè”ç³»äººï¼Œå§“åæ˜¯å¼ ä¸‰ï¼Œæ€§åˆ«æ˜¯ç”·ï¼Œå…³ç³»æ˜¯åŒäº‹ï¼Œåœ¨åŒ—äº¬
```

æœŸæœ› Agent è°ƒç”¨ `database_tool` å·¥å…·ï¼Œå¹¶è¿”å›æˆåŠŸä¿¡æ¯ã€‚

---

## ğŸ“Š å¯ç”¨å·¥å…·åˆ—è¡¨

| tool_name | æè¿° | tool_params |
|-----------|------|-------------|
| `login` | ç”¨æˆ·ç™»å½• | `{username, password}` |
| `register` | ç”¨æˆ·æ³¨å†Œ | `{username, password, name}` |
| `get_user_info` | è·å–ç”¨æˆ·ä¿¡æ¯ | `{}` |
| `reset_password` | é‡ç½®å¯†ç  | `{username, new_password}` |
| `query_contacts` | æŸ¥è¯¢è”ç³»äººåˆ—è¡¨ | `{}` |
| `add_contact` | æ·»åŠ è”ç³»äºº | `{contact_data}` |
| `query_user_reports` | æŸ¥è¯¢ç”¨æˆ·æŠ¥å‘Š | `{report_type}` |
| `save_report` | ä¿å­˜æŠ¥å‘Š | `{report_type, report_data}` |
| `update_user_profile` | æ›´æ–°ç”¨æˆ·èµ„æ–™ | `{profile_data}` |

---

## âš ï¸ å¸¸è§é—®é¢˜

### 1. Agent ä¸è°ƒç”¨å·¥å…·

**å¯èƒ½åŸå› **ï¼š
- å·¥å…·é…ç½®å‚æ•°ä¸æ­£ç¡®
- æç¤ºè¯æ²¡æœ‰å¼•å¯¼ Agent è°ƒç”¨å·¥å…·
- å¤–éƒ¨ API æœåŠ¡ä¸å¯ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥å¤–éƒ¨ API æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š`curl http://your-server-ip:5001/api/health`
- æ£€æŸ¥å·¥å…·é…ç½®æ˜¯å¦æ­£ç¡®ï¼ˆè¯·æ±‚ URLã€å‚æ•°ç­‰ï¼‰
- ä¼˜åŒ–æç¤ºè¯ï¼Œæ˜ç¡®å¼•å¯¼ Agent è°ƒç”¨å·¥å…·

### 2. å·¥å…·è°ƒç”¨å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- å¤–éƒ¨ API æœåŠ¡è¿”å›é”™è¯¯
- å‚æ•°ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æŸ¥çœ‹å¤–éƒ¨ API æœåŠ¡æ—¥å¿—ï¼š`tail -f api.log`
- æ£€æŸ¥è¯·æ±‚å‚æ•°æ˜¯å¦ç¬¦åˆè¦æ±‚
- ç¡®è®¤ user_id å‚æ•°æ˜¯å¦ä¼ é€’

### 3. è·¨åŸŸé—®é¢˜

**å¯èƒ½åŸå› **ï¼š
- Coze å¹³å°æ— æ³•è®¿é—®ä½ çš„æœåŠ¡å™¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿æœåŠ¡å™¨å¯ä»¥å…¬ç½‘è®¿é—®
- æ£€æŸ¥é˜²ç«å¢™è§„åˆ™ï¼Œå¼€æ”¾ 5001 ç«¯å£
- ä½¿ç”¨ HTTPSï¼ˆæ¨èï¼‰

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- å¤–éƒ¨ API æ–‡æ¡£ï¼š`API_USAGE.md`
- éƒ¨ç½²æ–‡æ¡£ï¼š`DEPLOYMENT.md`
- å‰ç«¯å¯¹æ¥æŒ‡å—ï¼š`FRONTEND_GUIDE.md`

---

## âœ¨ æ€»ç»“

é€šè¿‡é…ç½®å¤–éƒ¨ API å·¥å…·ï¼ŒCoze å¹³å°çš„ Agent å¯ä»¥è°ƒç”¨æœ¬åœ° Python æœåŠ¡ï¼Œå®ç°ï¼š

âœ… æ•°æ®åº“æ“ä½œï¼ˆç”¨æˆ·è®¤è¯ã€è”ç³»äººç®¡ç†ç­‰ï¼‰
âœ… è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘
âœ… ä¿æŒ Agent åœ¨ Coze å¹³å°ä¸Šè¿è¡Œ

**éƒ¨ç½²å®Œæˆåï¼ŒCoze Agent å°±å¯ä»¥è°ƒç”¨æœ¬åœ°æœåŠ¡çš„æ‰€æœ‰åŠŸèƒ½äº†ï¼** ğŸ‰
